# 智能考卷与阅卷系统功能文档 (SaaS版)

## 1. 系统概述
本系统是一套 LLM 增强的智能考试与阅卷平台，支持 **多租户、多用户协作**。系统不仅涵盖了从 **智能出卷** 到 **流水线阅卷** 的全流程管理，还支持学校级统一管理和班级数据分析。

## 2. 功能模块图

```mermaid
graph TD
    User([教师 / 管理员]) --> Frontend[前端 SPA (Vue3)]
    
    subgraph "应用层 (Docker Containers)"
        API[后端 API (FastAPI)]
        Worker[异步任务 Worker (Celery)]
    end
    
    subgraph "数据存储层"
        MySQL[(MySQL 8)]
        Redis[(Redis 7 - 缓存/队列)]
        MinIO[(MinIO - 对象存储)]
    end
    
    Frontend -->|REST API| API
    API --> MySQL
    API --> Redis
    API --> MinIO
    
    API -->|Task| Worker
    Worker --> Redis
    Worker --> MySQL
    Worker --> LLM_Service[外部 LLM API]
```

## 3. 核心功能详述

### 3.1 考试管理 (Exam Management - New!)
系统提供全周期的考卷管理能力，支持多种出卷模式：
*   **考卷维护**：支持新增、编辑、删除、查询考卷。
    *   **标准化导入**：支持上传标准化格式的考卷和标准答案文件直接创建。
    *   **试卷共享**：教师可将试卷共享给同事，实现资源复用。
    *   **答题卡同步**：一键从全局答题卡配置同步题型结构。
*   **题目管理**：
    *   **题型支持**：单选、多选、填空、是非、综合、编程等多种题型。
    *   **答案管理**：支持维护客观题标准答案和主观题评分标准（可后续追加）。
*   **智能出卷模式**：
    1.  **教师手动出卷**：教师录入知识点、题目和参考答案，人工确认。
    2.  **LLM 逐小题出题**：教师提供小题知识点，LLM 生成备选题目和答案，教师确认。
    3.  **LLM 逐大题出题**：教师提供大题要求，LLM 批量生成题目组，教师确认。
    4.  **LLM 独立出卷**：教师仅提供大题要求，LLM 自动生成完整试卷。
*   **答题卡配置**：支持上传答题卡模板，配置识别区域和匹配规则。

### 3.2 阅卷管理 (Grading Management)
*   **答卷采集**：
    *   **批量上传**：支持 Web 端批量上传答卷图片。
    *   **外部接口**：提供 API 接口供第三方扫描仪或应用导入答卷。
*   **智能阅卷**：
    *   **客观题**：自动识别填涂，比对标准答案一键判分。
    *   **主观题**：基于 LLM 的语义分析，提供评分建议、详细评语及修正参考。
*   **协同阅卷**：支持将试卷分块（Section），分配给不同教师流水线批改。
*   **结果分析**：
    *   **历史记录**：完整留存所有阅卷记录和修改日志。
    *   **成绩报表**：自动生成班级成绩单、分析报表，支持导出 Excel。

### 3.3 班级与学生管理 (Class Management)
*   **班级维护**：创建班级、年级管理。
*   **名单管理**：支持 CSV/Excel 导入学生名单，支持在线维护学生账号。
*   **成绩档案**：以班级为维度，查看全班学生在历次考试中的成绩汇总矩阵。
*   **账号生成**：可批量为学生生成登录账号，支持学生端查分（未来扩展）。

### 3.4 系统配置 (System Config)
*   **LLM 配置**：配置模型供应商（DeepSeek, OpenAI等）、API Key 及 Prompt 模板，用于主观题批改和智能出题。
*   **数据库配置**：热配置数据库连接，支持多环境切换。
*   **解析规则**：配置答题卡头部（学号/姓名）的正则提取规则。

## 4. 推荐工作流 (Recommended Workflow)

1.  **基础设置**：在`班级管理`导入名单，在`系统配置`完成 LLM 设置。
2.  **创建考试**：
    *   选择`从答题卡配置同步`快速生成结构，或使用`智能出卷`功能辅助命题。
    *   录入或导入标准答案。
3.  **答卷录入**：扫描并批量上传学生答卷。
4.  **智能/协同阅卷**：系统自动批改客观题；教师分配任务并完成主观题复核。
5.  **成绩发布与分析**：在`班级管理`一键查看并导出全班成绩总表。
