# LLM增强的智能考试与阅卷系统架构设计

## 1. 技术架构 (Technical Architecture)

本系统采用前后端分离的现代化微服务架构，基于 Docker 容器化部署。

### 1.1 技术栈 (Tech Stack)
*   **前端**: Vue 3 + Vite + Element Plus (SPA)
*   **后端 API**: Python FastAPI (异步高性能 Web 框架)
*   **异步任务**: Celery + Redis (处理 OCR 解析、LLM 推理等耗时任务)
*   **数据库**: MySQL 8.0 (业务数据), Redis 7 (缓存/队列)
*   **对象存储**: MinIO (自建 S3 兼容存储，用于存放试卷图片、PDF)
*   **AI/LLM**: 集成 OpenAI 兼容接口 (如 DeepSeek, GPT-4)，支持流式输出

### 1.2 部署架构 (Deployment)
```
[Nginx (Gateway)]
      |
      +--> [Frontend Container (Vue3)]
      |
      +--> [Backend API Container (FastAPI)] --+--> [MySQL]
               |                               |
               +--> [Celery Worker] -----------+--> [Redis]
                       |                       |
                       +--> [LLM Service]      +--> [MinIO]
```

## 2. 功能模块详解 (Functional Modules)

### 2.1 考试管理 (Exam Management)
负责考卷的生命周期管理，支持多种灵活的出卷方式。
*   **考卷管理 API** (`/api/v1/exams`)
    *   **基础操作**：创建、编辑、删除、发布、归档。
    *   **标准化导入**：支持上传 JSON/Excel 标准格式文件，自动解析生成试卷结构。
    *   **试卷共享** (New!)：基于 `source_exam_id` 实现的试卷克隆与共享机制，实现校内资源互通。
    *   **答题卡同步**：与全局 `AnswerSheetConfig` 联动，一键同步题型结构。
*   **题目管理** (`Questions Schemas`)
    *   支持 7 种标准题型：单选、多选、填空、是非、综合、编程、其他。
    *   **答案/评分标准**：支持结构化存储标准答案（客观题）和 LLM 评分 Prompt（主观题）。
*   **智能出卷引擎** (LLM-Enhanced Generation)
    *   **教师手动出卷**：传统模式，完全人工录入。
    *   **LLM 逐小题出题**：交互式生成，教师确认每一题。
    *   **LLM 逐大题出题**：批量生成 Section，类似于 "Generate 5 math problems about calculus"。
    *   **LLM 独立出卷**：全自动模式，根据大纲生成完整试卷。

### 2.2 阅卷管理 (Grading System)
采用 "流水线" + "人机协作" 的阅卷模式。
*   **答卷采集**
    *   **Web 上传**：通过前端界面批量上传图片。
    *   **外部接口** (`/api/v1/upload/external`)：供扫描仪或第三方 App 调用。
*   **智能阅卷管道** (Async Pipeline)
    1.  **OCR 解析**：Celery Worker 异步识别学号、姓名及客观题填涂。
    2.  **身份匹配**：自动匹配班级名单，异常处理（如学号填涂错误）。
    3.  **客观题自动批改**：比对标准答案，毫秒级出分。
    4.  **主观题 AI 预批**：LLM 分析作答内容，给出参考分和评语。
*   **教师复核**
    *   **任务分发**：支持按题型将任务分配给不同教师。
    *   **留痕**：所有的修改操作均记录在案。
*   **成绩归档**
    *   生成详细的 `ExamRecord`，支持导出 Excel 报表。

### 2.3 班级与学生管理 (Class & Student)
*   **班级维度**：支持按班级查看“成绩矩阵” (Gradebook Matrix)。
*   **名单管理**：支持 CSV 导入花名册，并一键同步生成学生登录账号。

### 2.4 系统配置 (Configuration)
*   **LLM 配置**：动态配置模型参数、API Key (支持多租户配置)。
*   **答题卡配置**：可视化配置答题卡锚点、题块区域。